#!/bin/bash
set -e

pnpm install --frozen-lockfile

if git diff --name-only | grep -qx "pnpm-lock.yaml"; then
  echo "‚ùå ERROR: Detected changes to pnpm-lock.yaml that are not committed. Please add and commit the lockfile before proceeding."
  exit 1
fi

pnpm run generate --filter=back-end --ui=stream
pnpm run pre-commit

git update-index --again
