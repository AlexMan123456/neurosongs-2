#!/bin/bash
set -e

if git diff --cached --quiet; then
  echo "No staged changes found."
  exit 0
fi

pnpm install --frozen-lockfile

if git diff --name-only | grep -qx "pnpm-lock.yaml"; then
  echo "‚ùå ERROR: Detected changes to pnpm-lock.yaml that are not committed. Please add and commit the lockfile before proceeding."
  exit 1
fi

pnpm run generate --filter=back-end --ui=stream
pnpm run build --ui=stream
pnpm run format --ui=stream
pnpm run lint --ui=stream
pnpm test --ui=stream

git update-index --again
